// Dark mode
const root = document.documentElement;
const themeToggle = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'light') root.classList.add('light');
if (themeToggle) {
  themeToggle.textContent = root.classList.contains('light') ? 'ðŸŒž' : 'ðŸŒ™';
  themeToggle.addEventListener('click', () => {
    root.classList.toggle('light');
    localStorage.setItem('theme', root.classList.contains('light') ? 'light' : 'dark');
    themeToggle.textContent = root.classList.contains('light') ? 'ðŸŒž' : 'ðŸŒ™';
  });
}

// Mobile nav
const navToggle = document.querySelector('.nav-toggle');
const navMenu = document.getElementById('navMenu');
if (navToggle && navMenu) {
  navToggle.addEventListener('click', () => {
    const open = navMenu.classList.toggle('open');
    navToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
  });
  navMenu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => {
    navMenu.classList.remove('open');
    navToggle.setAttribute('aria-expanded', 'false');
  }));
}

// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(link => {
  link.addEventListener('click', e => {
    const id = link.getAttribute('href').slice(1);
    const target = document.getElementById(id);
    if (target) {
      e.preventDefault();
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      history.pushState(null, '', '#' + id);
    }
  });
});

// Year
document.getElementById('year').textContent = new Date().getFullYear();

// Project filter
const filterButtons = document.querySelectorAll('.filter-btn');
const cards = document.querySelectorAll('.projects-grid .card');
filterButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    filterButtons.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
    btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
    const tag = btn.dataset.filter;
    cards.forEach(card => {
      if (tag === 'all') { card.style.display = ''; return; }
      const tags = (card.dataset.tags || '').split(' ');
      card.style.display = tags.includes(tag) ? '' : 'none';
    });
  });
});

// Modal
document.querySelectorAll('.more-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const id = btn.dataset.modal;
    const modal = document.getElementById(id);
    if (!modal) return;
    modal.setAttribute('aria-hidden','false');
    const close = modal.querySelector('.modal-close');
    const onKey = (e) => { if (e.key === 'Escape') close.click(); };
    document.addEventListener('keydown', onKey);
    close.addEventListener('click', () => {
      modal.setAttribute('aria-hidden','true');
      document.removeEventListener('keydown', onKey);
    }, { once: true });
    modal.addEventListener('click', (e) => {
      if (e.target === modal) close.click();
    }, { once: true });
  });
});


